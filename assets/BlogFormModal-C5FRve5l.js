import{r as h,j as e,a6 as z,a7 as R,a8 as q,X as L,a9 as M,a4 as D,m as l,aa as H,b as _,a5 as G,A as I,e as J,ab as O}from"./index-BMYFdNTb.js";import{u as V,I as B}from"./Input-DOROip8P.js";import{u as X,c as Q}from"./blogService-CXlcAJ04.js";import{u as W}from"./uploadService-C2iWP3Ke.js";import{T as F}from"./Textarea-Bvq7xGxW.js";import{B as U}from"./Button-2lqQSrpb.js";import{B as K}from"./constants-DAdbbRzX.js";const Y=({onSave:p,initialContent:y=[]})=>{const[n,j]=h.useState(y||[]),[b,x]=h.useState(null),[f,N]=h.useState(!1),c=t=>{const s={type:t,content:"",imageUrl:"",imageCaption:"",imageAlt:"",language:"javascript",listItems:[],alignment:"left",order:n.length};j([...n,s]),x(n.length)},r=(t,s)=>{const a=[...n];a[t]={...a[t],...s},j(a)},d=t=>{j(n.filter((s,a)=>a!==t)),b===t&&x(null)},C=(t,s)=>{const a=[...n];s==="up"&&t>0?([a[t],a[t-1]]=[a[t-1],a[t]],x(t-1)):s==="down"&&t<n.length-1&&([a[t],a[t+1]]=[a[t+1],a[t]],x(t+1)),j(a)},u=()=>{p(n)},S=t=>{switch(t.type){case"paragraph":return t.content.substring(0,50)+(t.content.length>50?"...":"");case"heading1":case"heading2":case"heading3":return`${t.type}: ${t.content.substring(0,40)}`;case"image":return`Image: ${t.imageCaption||t.imageAlt||"No caption"}`;case"quote":return`"${t.content.substring(0,40)}..."`;case"code":return`Code (${t.language}): ${t.content.substring(0,30)}...`;case"list":return`List: ${t.listItems.length} items`;default:return"Unknown block"}},m=({block:t,index:s})=>e.jsxs("div",{className:`editor-block ${b===s?"selected":""}`,onClick:()=>x(s),children:[e.jsxs("div",{className:"editor-block-header",children:[e.jsxs("div",{className:"block-info",children:[e.jsx("span",{className:"block-type-badge",children:t.type}),e.jsx("span",{className:"block-preview",children:S(t)})]}),e.jsxs("div",{className:"block-actions",children:[e.jsx("button",{className:"block-btn",onClick:a=>{a.stopPropagation(),C(s,"up")},disabled:s===0,title:"Move up",children:e.jsx(H,{size:12})}),e.jsx("button",{className:"block-btn",onClick:a=>{a.stopPropagation(),C(s,"down")},disabled:s===n.length-1,title:"Move down",children:e.jsx(_,{size:12})}),e.jsx("button",{className:"block-btn danger",onClick:a=>{a.stopPropagation(),d(s)},title:"Delete",children:e.jsx(G,{size:12})})]})]}),e.jsx(I,{children:b===s&&e.jsx(l.div,{className:"editor-block-content",initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2},children:P(t,s)})})]}),P=(t,s)=>e.jsxs("div",{className:"block-editor-form",children:[(t.type==="paragraph"||t.type==="heading1"||t.type==="heading2"||t.type==="heading3"||t.type==="quote")&&e.jsx("textarea",{value:t.content,onChange:a=>r(s,{content:a.target.value}),placeholder:`Enter ${t.type} text...`,className:"editor-input",rows:t.type==="paragraph"?4:2}),t.type==="image"&&e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",value:t.imageUrl,onChange:a=>r(s,{imageUrl:a.target.value}),placeholder:"Image URL...",className:"editor-input"}),e.jsx("input",{type:"text",value:t.imageAlt,onChange:a=>r(s,{imageAlt:a.target.value}),placeholder:"Alt text...",className:"editor-input"}),e.jsx("textarea",{value:t.imageCaption,onChange:a=>r(s,{imageCaption:a.target.value}),placeholder:"Caption (optional)...",className:"editor-input",rows:2}),e.jsx("div",{className:"alignment-options",children:["left","center","right"].map(a=>e.jsxs("label",{className:"align-option",children:[e.jsx("input",{type:"radio",name:`align-${s}`,value:a,checked:t.alignment===a,onChange:()=>r(s,{alignment:a})}),a.charAt(0).toUpperCase()+a.slice(1)]},a))}),t.imageUrl&&e.jsx("div",{className:"image-thumb",children:e.jsx("img",{src:t.imageUrl,alt:"Preview"})})]}),t.type==="code"&&e.jsxs(e.Fragment,{children:[e.jsxs("select",{value:t.language,onChange:a=>r(s,{language:a.target.value}),className:"editor-select",children:[e.jsx("option",{value:"javascript",children:"JavaScript"}),e.jsx("option",{value:"typescript",children:"TypeScript"}),e.jsx("option",{value:"python",children:"Python"}),e.jsx("option",{value:"html",children:"HTML"}),e.jsx("option",{value:"css",children:"CSS"}),e.jsx("option",{value:"jsx",children:"JSX"}),e.jsx("option",{value:"bash",children:"Bash"})]}),e.jsx("textarea",{value:t.content,onChange:a=>r(s,{content:a.target.value}),placeholder:"Paste code here...",className:"editor-input code",rows:5,spellCheck:"false"})]}),t.type==="list"&&e.jsxs("div",{className:"list-editor",children:[t.listItems.map((a,v)=>e.jsxs("div",{className:"list-item",children:[e.jsx("input",{type:"text",value:a,onChange:k=>{const w=[...t.listItems];w[v]=k.target.value,r(s,{listItems:w})},placeholder:`Item ${v+1}`,className:"editor-input"}),e.jsx("button",{className:"item-delete",onClick:()=>{const k=t.listItems.filter((w,A)=>A!==v);r(s,{listItems:k})},type:"button",children:"Ã—"})]},v)),e.jsx("button",{className:"add-item-btn",onClick:()=>r(s,{listItems:[...t.listItems,""]}),type:"button",children:"+ Add Item"})]})]});return e.jsxs("div",{className:"blog-block-editor",children:[e.jsx("div",{className:"editor-toolbar",children:e.jsxs("div",{className:"toolbar-buttons",children:[e.jsx("button",{className:"add-block-btn",onClick:()=>c("paragraph"),title:"Add paragraph",children:"P"}),e.jsx("button",{className:"add-block-btn",onClick:()=>c("heading2"),title:"Add heading",children:e.jsx(z,{size:12})}),e.jsx("button",{className:"add-block-btn",onClick:()=>c("image"),title:"Add image",children:e.jsx(R,{size:12})}),e.jsx("button",{className:"add-block-btn",onClick:()=>c("quote"),title:"Add quote",children:e.jsx(q,{size:12})}),e.jsx("button",{className:"add-block-btn",onClick:()=>c("code"),title:"Add code",children:e.jsx(L,{size:12})}),e.jsx("button",{className:"add-block-btn",onClick:()=>c("list"),title:"Add list",children:e.jsx(M,{size:12})})]})}),e.jsx("div",{className:"editor-blocks",children:n.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx(D,{size:24}),e.jsx("p",{children:"No content blocks yet. Click the buttons above to start building your post."})]}):e.jsx(l.div,{layout:!0,className:"blocks-list",children:n.map((t,s)=>e.jsx(l.div,{layout:!0,initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},children:e.jsx(m,{block:t,index:s})},s))})}),n.length>0&&e.jsxs("div",{className:"editor-footer",children:[e.jsx("button",{className:"preview-toggle",onClick:()=>N(!f),type:"button",children:f?"âœŽ Edit":"ðŸ‘ Preview"}),e.jsx("button",{className:"save-btn",onClick:u,type:"button",children:"âœ“ Save Blocks"})]})]})},ne=({post:p,onClose:y})=>{const[n,j]=h.useState(!1),[b,x]=h.useState(!1),[f,N]=h.useState(""),[c,r]=h.useState(p?.contentBlocks||[]),[d,C]=h.useState(!!p?.contentBlocks?.length),[u,S]=h.useState({basic:!0,content:!0,settings:!1}),{register:m,handleSubmit:P,formState:{errors:t},setValue:s,watch:a}=V({defaultValues:p||{title:"",excerpt:"",content:"",contentBlocks:[],featuredImage:"",featuredImageAlt:"",category:"Tech",tags:"",published:!0}}),v=a("featuredImage");h.useEffect(()=>(document.body.style.overflow="hidden",()=>{document.body.style.overflow="unset"}),[]);const k=i=>{S(o=>({...o,[i]:!o[i]}))},w=async i=>{const o=i.target.files[0];if(o)try{x(!0);const g=await W(o);s("featuredImage",g.url)}catch{alert("Failed to upload image")}finally{x(!1)}},A=i=>{r(i),S(o=>({...o,content:!0}))},T=async i=>{try{if(j(!0),N(""),!i.featuredImage){N("Please upload or provide a featured image");return}if(d&&c.length===0){N("Please add at least one content block");return}const o={...i,contentBlocks:d?c:[],content:d?"":i.content,tags:i.tags.split(",").map(g=>g.trim()).filter(g=>g),featuredImageAlt:i.featuredImageAlt||""};p?await X(p._id,o):await Q(o),y()}catch(o){N(o.response?.data?.message||"Failed to save post")}finally{j(!1)}},$=()=>d?e.jsx(l.div,{className:"content-blocks-status",initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},children:e.jsx("div",{className:"status-indicator",children:c.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"status-dot active"}),e.jsxs("span",{className:"status-text",children:[c.length," content block",c.length!==1?"s":""," added"]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"status-dot"}),e.jsx("span",{className:"status-text",children:"No content blocks yet"})]})})}):null,E=({title:i,section:o,icon:g})=>e.jsxs("button",{type:"button",className:"section-header",onClick:()=>k(o),children:[e.jsxs("div",{className:"section-title",children:[g&&e.jsx(g,{size:16}),e.jsx("h3",{children:i})]}),e.jsx(l.div,{animate:{rotate:u[o]?180:0},transition:{duration:.2},children:e.jsx(O,{size:16})})]});return e.jsx(I,{children:e.jsx("div",{className:"modal-overlay",onClick:y,children:e.jsxs(l.div,{className:"blog-form-modal",initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},onClick:i=>i.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("div",{className:"modal-title-section",children:[e.jsx("h2",{children:p?"Edit Blog Post":"Create New Post"}),e.jsx("span",{className:"modal-subtitle",children:d?"Rich Content Mode":"Classic Mode"})]}),e.jsx("button",{onClick:y,className:"modal-close-btn",children:e.jsx(J,{size:20})})]}),e.jsxs("form",{onSubmit:P(T),className:"blog-form",children:[e.jsxs(l.section,{className:`form-section ${u.basic?"expanded":"collapsed"}`,initial:!1,children:[e.jsx(E,{title:"Basic Information",section:"basic"}),e.jsx(I,{children:u.basic&&e.jsxs(l.div,{className:"section-content",initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.3},children:[e.jsx(B,{label:"Title",name:"title",placeholder:"Getting Started with React Hooks",register:m,error:t.title,required:!0}),e.jsx(F,{label:"Excerpt",name:"excerpt",placeholder:"Short summary of your post...",rows:2,register:m,error:t.excerpt,required:!0}),e.jsx(B,{label:"Tags (comma-separated)",name:"tags",placeholder:"React, JavaScript, Tutorial",register:m}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Category"}),e.jsx("select",{...m("category"),className:"form-select",children:K.map(i=>e.jsx("option",{value:i,children:i},i))})]}),e.jsx("div",{className:"form-group",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",...m("published")}),e.jsx("span",{children:"Publish"})]})})]})]})})]}),e.jsxs(l.section,{className:`form-section ${u.basic?"expanded":"collapsed"}`,initial:!1,children:[e.jsx(E,{title:"Featured Image",section:"basic"}),e.jsx(I,{children:u.basic&&e.jsxs(l.div,{className:"section-content",initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.3},children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Upload Image"}),e.jsx("input",{type:"file",accept:"image/*",onChange:w,disabled:b,className:"file-input"}),b&&e.jsx("p",{className:"uploading",children:"Uploading..."})]}),e.jsx(B,{label:"Or Paste Image URL",name:"featuredImage",placeholder:"https://...",register:m,error:t.featuredImage}),e.jsx(B,{label:"Image Alt Text (for accessibility)",name:"featuredImageAlt",placeholder:"Describe the image...",register:m}),v&&e.jsx(l.div,{className:"image-preview-container",initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},children:e.jsx("img",{src:v,alt:"Preview",className:"image-preview"})})]})})]}),e.jsxs(l.section,{className:`form-section content-section ${u.content?"expanded":"collapsed"}`,initial:!1,children:[e.jsx(E,{title:"Post Content",section:"content"}),e.jsx(I,{children:u.content&&e.jsxs(l.div,{className:"section-content",initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.3},children:[e.jsxs("div",{className:"content-mode-toggle",children:[e.jsxs("label",{className:"mode-toggle-label",children:[e.jsx("input",{type:"radio",value:"rich",checked:d,onChange:()=>C(!0)}),e.jsx("span",{className:"toggle-text",children:"Rich Blocks Editor"})]}),e.jsxs("label",{className:"mode-toggle-label",children:[e.jsx("input",{type:"radio",value:"classic",checked:!d,onChange:()=>C(!1)}),e.jsx("span",{className:"toggle-text",children:"Classic Text Editor"})]})]}),d&&e.jsxs(l.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"rich-editor-wrapper",children:[e.jsx(Y,{onSave:A,initialContent:c}),e.jsx($,{})]}),!d&&e.jsxs(l.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:[e.jsx(F,{label:"Content",name:"content",placeholder:"Write your blog post content here... (Separate paragraphs with blank lines)",rows:12,register:m,error:t.content,required:!0}),e.jsx("div",{className:"editor-hint",children:"ðŸ’¡ Tip: Use blank lines to separate paragraphs"})]})]})})]}),f&&e.jsx(l.div,{className:"error-banner",initial:{opacity:0,y:-10},animate:{opacity:1,y:0},children:f}),e.jsxs("div",{className:"form-actions",children:[e.jsx(U,{type:"button",variant:"secondary",onClick:y,children:"Cancel"}),e.jsx(U,{type:"submit",variant:"primary",disabled:n||d&&c.length===0,children:n?"Saving...":p?"Update Post":"Create Post"})]})]})]})})})};export{ne as default};
