import{r,j as e,A as k,m as j,e as E,a3 as F}from"./index-Bc1wNwMh.js";import{u as U,I as y}from"./Input-BwNzFWQN.js";import{r as T,u as C,c as G}from"./galleryService-lJawHhqk.js";import{u as O}from"./uploadService-BTLtl3e2.js";import{T as R}from"./Textarea-BBme-3jo.js";import{B as v}from"./Button-qLJbJigL.js";const q=({image:t,onClose:o})=>{const[u,p]=r.useState(!1),[h,f]=r.useState(!1),[g,m]=r.useState(""),[l,n]=r.useState([]),[b,x]=r.useState(null),{register:i,handleSubmit:N,formState:{errors:I},setValue:_}=U({defaultValues:t||{title:"",description:"",category:"Other",order:0,featured:!1}});r.useEffect(()=>(document.body.style.overflow="hidden",t&&n(t.imageUrls||[]),()=>{document.body.style.overflow="unset"}),[t]);const w=async s=>{const a=s.target.files[0];if(a)try{f(!0);const c=await O(a);n([...l,c.url])}catch{alert("Failed to upload image")}finally{f(!1)}},P=async s=>{if(t&&window.confirm("Remove this image?"))try{x(s),await T(t._id,s);const a=l.filter((c,d)=>d!==s);n(a)}catch{alert("Failed to remove image")}finally{x(null)}else if(!t){const a=l.filter((c,d)=>d!==s);n(a)}},S=async s=>{try{if(p(!0),m(""),l.length===0){m("Please upload at least one image");return}const a={...s,imageUrls:l};t?await C(t._id,a):await G(a),o()}catch(a){m(a.response?.data?.message||"Failed to save post")}finally{p(!1)}};return e.jsx(k,{children:e.jsx("div",{className:"modal-overlay",onClick:o,children:e.jsxs(j.div,{className:"gallery-form-modal",initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:t?"Edit Gallery Post":"Create New Gallery Post"}),e.jsx("button",{onClick:o,className:"modal-close-btn",children:e.jsx(E,{size:20})})]}),e.jsxs("form",{onSubmit:N(S),className:"gallery-form",children:[e.jsx(y,{label:"Title",name:"title",placeholder:"Working on Project",register:i,error:I.title,required:!0}),e.jsx(R,{label:"Description (optional)",name:"description",placeholder:"Tell the story behind these images...",rows:3,register:i}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Category"}),e.jsxs("select",{...i("category"),className:"form-select",children:[e.jsx("option",{value:"Work",children:"Work"}),e.jsx("option",{value:"Personal",children:"Personal"}),e.jsx("option",{value:"Events",children:"Events"}),e.jsx("option",{value:"Travel",children:"Travel"}),e.jsx("option",{value:"Other",children:"Other"})]})]}),e.jsx(y,{label:"Order",name:"order",type:"number",placeholder:"0",register:i}),e.jsx("div",{className:"form-group",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",...i("featured")}),e.jsx("span",{children:"Featured Post"})]})}),e.jsxs("div",{className:"images-section",children:[e.jsxs("label",{children:["Gallery Images (",l.length,")"]}),e.jsxs("div",{className:"upload-area",children:[e.jsx("input",{type:"file",multiple:!0,accept:"image/*",onChange:s=>{Array.from(s.target.files||[]).forEach(a=>{w({target:{files:[a]}})})},disabled:h,className:"file-input"}),e.jsxs("div",{className:"upload-placeholder",children:[e.jsx("p",{children:"Drag and drop images here or click to select"}),h&&e.jsx("p",{className:"uploading",children:"Uploading..."})]})]}),l.length>0&&e.jsx("div",{className:"images-grid",children:l.map((s,a)=>e.jsxs(j.div,{className:"image-item",initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},children:[e.jsx("img",{src:s,alt:`Preview ${a+1}`}),e.jsx("button",{type:"button",onClick:()=>P(a),disabled:b===a,className:"remove-image-btn",children:e.jsx(F,{size:14})}),e.jsx("span",{className:"image-number",children:a+1})]},a))})]}),g&&e.jsx("p",{className:"error-text",children:g}),e.jsxs("div",{className:"form-actions",children:[e.jsx(v,{type:"button",variant:"secondary",onClick:o,children:"Cancel"}),e.jsx(v,{type:"submit",variant:"primary",disabled:u,children:u?"Saving...":t?"Update Post":"Create Post"})]})]})]})})})};export{q as default};
