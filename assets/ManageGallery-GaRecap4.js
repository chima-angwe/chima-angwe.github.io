import{r as o,j as e,m as v,e as F,J as P,h as U,H as b,C as w,I as G}from"./index-Ctl3OINq.js";import{u as z,E as T}from"./ErrorMessage-DHev1uHZ.js";import{r as M,u as _,c as A,d as D,g as R}from"./galleryService--h1KvTzG.js";import{B as j}from"./Button-PIolUsCM.js";import{u as O,I}from"./Input-CgTt5tG4.js";import{u as W}from"./uploadService-CPDpqT1g.js";import{T as B}from"./Textarea-Ub0A6M40.js";import{A as H}from"./index-Cmy4rXYY.js";const V=({image:t,onClose:i})=>{const[u,c]=o.useState(!1),[d,p]=o.useState(!1),[h,n]=o.useState(""),[r,m]=o.useState([]),[y,g]=o.useState(null),{register:s,handleSubmit:N,formState:{errors:C},setValue:q}=O({defaultValues:t||{title:"",description:"",category:"Other",order:0,featured:!1}});o.useEffect(()=>(document.body.style.overflow="hidden",t&&m(t.imageUrls||[]),()=>{document.body.style.overflow="unset"}),[t]);const S=async l=>{const a=l.target.files[0];if(a)try{p(!0);const x=await W(a);m([...r,x.url])}catch{alert("Failed to upload image")}finally{p(!1)}},k=async l=>{if(t&&window.confirm("Remove this image?"))try{g(l),await M(t._id,l);const a=r.filter((x,f)=>f!==l);m(a)}catch{alert("Failed to remove image")}finally{g(null)}else if(!t){const a=r.filter((x,f)=>f!==l);m(a)}},E=async l=>{try{if(c(!0),n(""),r.length===0){n("Please upload at least one image");return}const a={...l,imageUrls:r};t?await _(t._id,a):await A(a),i()}catch(a){n(a.response?.data?.message||"Failed to save post")}finally{c(!1)}};return e.jsx(H,{children:e.jsx("div",{className:"modal-overlay",onClick:i,children:e.jsxs(v.div,{className:"gallery-form-modal",initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},onClick:l=>l.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:t?"Edit Gallery Post":"Create New Gallery Post"}),e.jsx("button",{onClick:i,className:"modal-close-btn",children:e.jsx(F,{size:20})})]}),e.jsxs("form",{onSubmit:N(E),className:"gallery-form",children:[e.jsx(I,{label:"Title",name:"title",placeholder:"Working on Project",register:s,error:C.title,required:!0}),e.jsx(B,{label:"Description (optional)",name:"description",placeholder:"Tell the story behind these images...",rows:3,register:s}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Category"}),e.jsxs("select",{...s("category"),className:"form-select",children:[e.jsx("option",{value:"Work",children:"Work"}),e.jsx("option",{value:"Personal",children:"Personal"}),e.jsx("option",{value:"Events",children:"Events"}),e.jsx("option",{value:"Travel",children:"Travel"}),e.jsx("option",{value:"Other",children:"Other"})]})]}),e.jsx(I,{label:"Order",name:"order",type:"number",placeholder:"0",register:s}),e.jsx("div",{className:"form-group",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",...s("featured")}),e.jsx("span",{children:"Featured Post"})]})}),e.jsxs("div",{className:"images-section",children:[e.jsxs("label",{children:["Gallery Images (",r.length,")"]}),e.jsxs("div",{className:"upload-area",children:[e.jsx("input",{type:"file",multiple:!0,accept:"image/*",onChange:l=>{Array.from(l.target.files||[]).forEach(a=>{S({target:{files:[a]}})})},disabled:d,className:"file-input"}),e.jsxs("div",{className:"upload-placeholder",children:[e.jsx("p",{children:"Drag and drop images here or click to select"}),d&&e.jsx("p",{className:"uploading",children:"Uploading..."})]})]}),r.length>0&&e.jsx("div",{className:"images-grid",children:r.map((l,a)=>e.jsxs(v.div,{className:"image-item",initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},children:[e.jsx("img",{src:l,alt:`Preview ${a+1}`}),e.jsx("button",{type:"button",onClick:()=>k(a),disabled:y===a,className:"remove-image-btn",children:e.jsx(P,{size:14})}),e.jsx("span",{className:"image-number",children:a+1})]},a))})]}),h&&e.jsx("p",{className:"error-text",children:h}),e.jsxs("div",{className:"form-actions",children:[e.jsx(j,{type:"button",variant:"secondary",onClick:i,children:"Cancel"}),e.jsx(j,{type:"submit",variant:"primary",disabled:u,children:u?"Saving...":t?"Update Post":"Create Post"})]})]})]})})})},ee=()=>{const[t,i]=o.useState(!1),[u,c]=o.useState(null),{data:d,loading:p,error:h,refetch:n}=z(R),r=()=>{c(null),i(!0)},m=s=>{c(s),i(!0)},y=async s=>{if(window.confirm("Are you sure you want to delete this gallery post?"))try{await D(s),n()}catch{alert("Failed to delete post")}},g=()=>{i(!1),c(null),n()};return p?e.jsx(U,{fullScreen:!0,size:"large"}):h?e.jsx(T,{message:h,onRetry:n}):e.jsxs("div",{className:"manage-gallery-page",children:[e.jsxs("div",{className:"manage-header",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"manage-title",children:"Manage Gallery"}),e.jsx("p",{className:"manage-subtitle",children:"Upload and manage your gallery posts with multiple images"})]}),e.jsxs(j,{variant:"primary",onClick:r,children:[e.jsx(b,{size:16}),"New Post"]})]}),d&&d.length>0?e.jsx("div",{className:"gallery-grid-admin",children:d.map(s=>e.jsxs(v.div,{className:"gallery-post-admin",initial:{opacity:0},animate:{opacity:1},whileHover:{y:-4},children:[e.jsxs("div",{className:"post-thumbnail",children:[e.jsx("img",{src:s.imageUrls[0],alt:s.title}),e.jsxs("div",{className:"image-count",children:[e.jsx(w,{size:12}),e.jsx("span",{children:s.imageUrls.length})]})]}),e.jsxs("div",{className:"post-info",children:[e.jsx("h3",{className:"post-title",children:s.title}),e.jsx("p",{className:"post-category",children:s.category}),s.featured&&e.jsx("span",{className:"featured-badge",children:"Featured"})]}),e.jsx("div",{className:"post-overlay",children:e.jsxs("div",{className:"post-actions",children:[e.jsx("button",{onClick:()=>m(s),className:"action-btn edit-btn",title:"Edit post",children:e.jsx(G,{size:16})}),e.jsx("button",{onClick:()=>y(s._id),className:"action-btn delete-btn",title:"Delete post",children:e.jsx(P,{size:16})})]})})]},s._id))}):e.jsxs("div",{className:"empty-state",children:[e.jsx(w,{size:48,className:"empty-icon"}),e.jsx("p",{children:"No gallery posts yet. Create your first post!"}),e.jsxs(j,{variant:"primary",onClick:r,children:[e.jsx(b,{size:16}),"Create Post"]})]}),t&&e.jsx(V,{image:u,onClose:g})]})};export{ee as default};
