import{G as U,r as i,j as e,a4 as R,a5 as B,a6 as P,a7 as z,a8 as A,a9 as D,aa as q,A as V,m as T,e as W}from"./index-Bc1wNwMh.js";import{u as G,I as S}from"./Input-BwNzFWQN.js";import{u as K,c as $}from"./blogService-CCp48gYV.js";import{u as O}from"./uploadService-BTLtl3e2.js";import{T as _}from"./Textarea-BBme-3jo.js";import{B as H}from"./Button-qLJbJigL.js";import{B as Q}from"./constants-DAdbbRzX.js";function Y(s){return U({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M4 12h8"},child:[]},{tag:"path",attr:{d:"M4 18V6"},child:[]},{tag:"path",attr:{d:"M12 18V6"},child:[]},{tag:"path",attr:{d:"m17 12 3-2v8"},child:[]}]})(s)}function J(s){return U({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M4 12h8"},child:[]},{tag:"path",attr:{d:"M4 18V6"},child:[]},{tag:"path",attr:{d:"M12 18V6"},child:[]},{tag:"path",attr:{d:"M21 18h-4c0-4 4-3 4-6 0-1.5-2-2.5-4-1"},child:[]}]})(s)}const Z=({initialContent:s="",onSave:f})=>{const r=i.useRef(null),[N,x]=i.useState(s),[d,k]=i.useState([s]),[o,g]=i.useState(0),[w,n]=i.useState(!1),j=i.useRef(null);i.useEffect(()=>{r.current&&s&&(r.current.innerHTML=s)},[]);const I=t=>{if(t===N)return;x(t);const u=d.slice(0,o+1);u.push(t),k(u),g(u.length-1)},C=()=>{if(o>0){const t=o-1;n(!0),g(t),x(d[t]),setTimeout(()=>{r.current&&(r.current.innerHTML=d[t]),n(!1)},0)}},y=()=>{if(o<d.length-1){const t=o+1;n(!0),g(t),x(d[t]),setTimeout(()=>{r.current&&(r.current.innerHTML=d[t]),n(!1)},0)}},m=(t,u=null)=>{document.execCommand(t,!1,u),r.current?.focus(),setTimeout(l,10)},v=t=>{const h=window.getSelection().toString()||"Click to edit...";let b="";switch(t){case"h1":b=`<h1>${h}</h1>`;break;case"h2":b=`<h2>${h}</h2>`;break;case"blockquote":b=`<blockquote>${h}</blockquote>`;break;default:b=`<p>${h}</p>`}m("insertHTML",b)},L=()=>{const t=prompt("Enter the URL:");t&&(window.getSelection().toString(),m("createLink",t))},F=()=>{const t=prompt("Enter the image URL:");t&&m("insertImage",t)},a=async t=>{const u=t.target.files[0];if(u){try{const h=new FileReader;h.onload=b=>{const M=b.target.result;m("insertImage",M)},h.onerror=()=>{alert("Failed to read image file")},h.readAsDataURL(u)}catch(h){alert("Failed to upload image"),console.error("Image upload error:",h)}j.current&&(j.current.value="")}},l=()=>{if(!w&&r.current){const t=r.current.innerHTML;I(t)}},c=()=>{l()},p=t=>{if(t.key==="Tab"){t.preventDefault(),m("insertHTML","&nbsp;&nbsp;&nbsp;&nbsp;");return}(t.key==="Enter"||t.key===" ")&&setTimeout(l,10),(t.ctrlKey||t.metaKey)&&(t.key==="z"?(t.preventDefault(),C()):t.key==="y"&&(t.preventDefault(),y()))},E=()=>{if(r.current){const t=r.current.innerHTML;f(t)}};return e.jsxs("div",{className:"simple-blog-editor",children:[e.jsxs("div",{className:"editor-toolbar",children:[e.jsxs("div",{className:"toolbar-group",children:[e.jsx("button",{type:"button",className:"toolbar-btn",onClick:C,disabled:o===0,title:"Undo (Ctrl+Z)",children:e.jsx(R,{size:14})}),e.jsx("button",{type:"button",className:"toolbar-btn",onClick:y,disabled:o===d.length-1,title:"Redo (Ctrl+Y)",children:e.jsx(B,{size:14})})]}),e.jsx("div",{className:"toolbar-divider"}),e.jsxs("div",{className:"toolbar-group",children:[e.jsx("button",{type:"button",className:"toolbar-btn",onClick:()=>m("bold"),title:"Bold (Ctrl+B)",children:e.jsx(P,{size:14})}),e.jsx("button",{type:"button",className:"toolbar-btn",onClick:()=>m("italic"),title:"Italic (Ctrl+I)",children:e.jsx(z,{size:14})})]}),e.jsx("div",{className:"toolbar-divider"}),e.jsxs("div",{className:"toolbar-group",children:[e.jsx("button",{type:"button",className:"toolbar-btn",onClick:()=>v("h1"),title:"Heading 1 (Large)",children:e.jsx(Y,{size:16})}),e.jsx("button",{type:"button",className:"toolbar-btn",onClick:()=>v("h2"),title:"Heading 2 (Small)",children:e.jsx(J,{size:14})}),e.jsx("button",{type:"button",className:"toolbar-btn",onClick:()=>v("blockquote"),title:"Quote",children:e.jsx(A,{size:14})})]}),e.jsx("div",{className:"toolbar-divider"}),e.jsxs("div",{className:"toolbar-group",children:[e.jsx("button",{type:"button",className:"toolbar-btn",onClick:L,title:"Insert Link",children:e.jsx(D,{size:14})}),e.jsx("button",{type:"button",className:"toolbar-btn",onClick:()=>j.current?.click(),title:"Upload Image from Computer",children:e.jsx(q,{size:14})}),e.jsx("button",{type:"button",className:"toolbar-btn",onClick:F,title:"Insert Image from URL",children:"üîóüì∏"})]}),e.jsx("input",{ref:j,type:"file",accept:"image/*",onChange:a,style:{display:"none"}})]}),e.jsx("div",{ref:r,className:"editor-content",contentEditable:!0,suppressContentEditableWarning:!0,onInput:c,onKeyDown:p}),e.jsx("div",{className:"editor-footer",children:e.jsx("button",{type:"button",className:"save-btn",onClick:E,children:"Save Content"})})]})},ne=({post:s,onClose:f})=>{const[r,N]=i.useState(!1),[x,d]=i.useState(!1),[k,o]=i.useState(""),[g,w]=i.useState(s?.content||""),{register:n,handleSubmit:j,formState:{errors:I},setValue:C,watch:y}=G({defaultValues:{title:s?.title||"",excerpt:s?.excerpt||"",featuredImage:s?.featuredImage||"",featuredImageAlt:s?.featuredImageAlt||"",category:s?.category||"Tech",tags:s?.tags?.join(", ")||"",published:s?.published!==!1}}),m=y("featuredImage");y("title"),i.useEffect(()=>(document.body.style.overflow="hidden",()=>{document.body.style.overflow="unset"}),[]);const v=async a=>{const l=a.target.files[0];if(l)try{d(!0);const c=await O(l);C("featuredImage",c.url)}catch(c){o("Failed to upload image"),console.error("Upload error:",c)}finally{d(!1)}},L=a=>{w(a)},F=async a=>{try{if(N(!0),o(""),!a.featuredImage?.trim()){o("Please upload or provide a featured image");return}if(!g.trim()){o("Please write some content for your post");return}if(!a.title?.trim()){o("Please add a title");return}if(!a.excerpt?.trim()){o("Please add an excerpt");return}const l=a.tags.split(",").map(p=>p.trim()).filter(p=>p.length>0),c={title:a.title,excerpt:a.excerpt,featuredImage:a.featuredImage,featuredImageAlt:a.featuredImageAlt||"",category:a.category,published:a.published,tags:l,content:g,contentBlocks:[]};if(console.log("Submitting data:",c),s&&s._id){const p=await K(s._id,c);console.log("Update response:",p)}else{const p=await $(c);console.log("Create response:",p)}f()}catch(l){const c=l.response?.data?.message||l.message||"Failed to save post";o(c),console.error("Submission error:",l)}finally{N(!1)}};return e.jsx(V,{children:e.jsx("div",{className:"modal-overlay",onClick:f,children:e.jsxs(T.div,{className:"simple-blog-form-modal",initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},onClick:a=>a.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("div",{children:[e.jsx("h2",{children:s?"Edit Post":"New Post"}),e.jsx("p",{className:"modal-subtitle",children:"Write and publish your thoughts"})]}),e.jsx("button",{onClick:f,className:"modal-close-btn",children:e.jsx(W,{size:20})})]}),e.jsxs("form",{onSubmit:j(F),className:"simple-blog-form",children:[e.jsx("div",{className:"form-section",children:e.jsx(S,{label:"Title",name:"title",placeholder:"Your compelling title here...",register:n,error:I.title,required:!0,large:!0})}),e.jsx("div",{className:"form-section",children:e.jsx(_,{label:"Excerpt",name:"excerpt",placeholder:"Brief summary of your post (shown in lists)...",rows:2,register:n,error:I.excerpt,required:!0})}),e.jsxs("div",{className:"form-section",children:[e.jsx("h3",{className:"section-label",children:"Featured Image"}),e.jsxs("div",{className:"image-upload-area",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:v,disabled:x,className:"file-input",id:"featured-image"}),e.jsx("label",{htmlFor:"featured-image",className:"file-input-label",children:x?e.jsx("span",{children:"Uploading..."}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"upload-icon",children:"üì∏"}),e.jsx("span",{children:"Click to upload or drag image"})]})})]}),e.jsx(S,{label:"Or paste image URL",name:"featuredImage",placeholder:"https://...",register:n}),e.jsx(S,{label:"Image alt text",name:"featuredImageAlt",placeholder:"Describe the image for accessibility...",register:n}),m&&e.jsx(T.div,{className:"image-preview",initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},children:e.jsx("img",{src:m,alt:"Preview"})})]}),e.jsxs("div",{className:"form-section content-section",children:[e.jsx("h3",{className:"section-label",children:"Content"}),e.jsx("p",{className:"section-description",children:"Write your post using the toolbar below. Format with bold, italic, headings, and more."}),e.jsx(Z,{initialContent:g,onSave:L})]}),e.jsx("div",{className:"form-section",children:e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Category"}),e.jsx("select",{...n("category"),className:"form-select",children:Q.map(a=>e.jsx("option",{value:a,children:a},a))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Tags"}),e.jsx(S,{name:"tags",placeholder:"React, JavaScript, Tutorial",register:n,noLabel:!0})]})]})}),e.jsx("div",{className:"form-section",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",...n("published"),defaultChecked:!0}),e.jsx("span",{children:"Publish this post"})]})}),k&&e.jsxs(T.div,{className:"error-banner",initial:{opacity:0,y:-10},animate:{opacity:1,y:0},children:["‚ö†Ô∏è ",k]}),e.jsxs("div",{className:"form-actions",children:[e.jsx(H,{type:"button",variant:"secondary",onClick:f,children:"Cancel"}),e.jsx(H,{type:"submit",variant:"primary",disabled:r,children:r?"Saving...":s?"Update Post":"Publish Post"})]})]})]})})})};export{ne as default};
